<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ë¯¸ìˆ  ì‘í’ˆ ì¶”ì²œ í”„ë¡œê·¸ë¨ (ArtMix + ì‘í’ˆ ì¶”ê°€ ê¸°ëŠ¥ í™•ì¥)</title>
    <style>
        /* ArtMix ë””ìì¸ ìŠ¤íƒ€ì¼ */
        body {
            margin: 0;
            font-family: "ë§‘ì€ ê³ ë”•", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f7fb;
        }

        header {
            background: #283593;
            color: white;
            padding: 16px 24px;
        }

        header h1 {
            margin: 0;
            font-size: 22px;
        }

        header p {
            margin: 4px 0 0;
            font-size: 13px;
            opacity: 0.9;
        }

        main.app-container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px 24px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 16px;
        }
        
        @media (max-width: 1024px) {
            main.app-container {
                grid-template-columns: 1fr;
            }
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .panel {
            background: white;
            border-radius: 10px;
            padding: 12px 14px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            box-sizing: border-box;
        }

        h2 {
            font-size: 16px;
            margin: 0 0 8px;
        }
        
        .mini-section-title {
            font-size: 14px;
            font-weight: 600;
            margin: 12px 0 6px;
            padding-top: 8px;
            border-top: 1px dashed #e0e0e0;
        }
        
        .mini-section-title:first-child {
             border-top: none;
             padding-top: 0;
             margin-top: 0;
        }

        .subtitle {
            font-size: 11px;
            color: #616161;
            margin-bottom: 8px;
        }

        label {
            display: block;
            font-size: 12px;
            margin: 6px 0 2px;
            font-weight: 600;
        }

        select, input[type="text"] {
            width: 100%;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #c5cae9;
            font-size: 12px;
            box-sizing: border-box;
        }

        .btn {
            border-radius: 999px;
            border: none;
            padding: 6px 10px;
            font-size: 12px;
            cursor: pointer;
            margin-right: 6px;
        }

        .btn-primary {
            background: #283593;
            color: white;
        }

        .btn-secondary {
            background: #eeeeee;
            color: #212121;
        }

        .btn-primary:hover {
            background: #1a237e;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .button-row {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        
        .list-small {
            font-size: 11px;
            padding-left: 14px;
            margin: 0 0 10px 0;
        }

        .list-small li {
            margin-bottom: 3px;
        }

        #resultContent {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-top: 10px;
        }

        .art-card {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 10px;
            background: #fafbff;
            display: flex;
            gap: 12px;
            font-size: 12px;
        }

        .art-image {
            flex: 0 0 150px;
            max-width: 150px;
        }

        .art-image img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            object-fit: cover;
            cursor: pointer;
        }

        .art-info {
            flex: 1 1 auto;
        }

        .art-info h3 {
            font-weight: 700;
            font-size: 13px;
            margin-top: 0;
            margin-bottom: 4px;
        }

        .art-info p {
            margin: 4px 0;
            font-size: 11px;
        }

        .art-info strong {
            font-weight: 600;
        }

        .chips {
            margin-top: 6px;
        }
        
        .hashtag, .chip {
            display: inline-block;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 999px;
            background: #e3f2fd;
            color: #212121;
            margin-right: 4px;
            margin-bottom: 4px;
            border: 1px solid #bbdefb;
            cursor: pointer;
        }

        .back-controls {
            margin-top: 15px;
            font-size: 12px;
            padding: 8px;
            border-top: 1px dashed #c5cae9;
        }

        .back-controls label {
             display: inline;
             font-weight: 400;
             margin-right: 5px;
        }

        .back-controls select {
            width: auto;
            display: inline-block;
            min-width: 150px;
        }

        .no-result {
            margin-top: 10px;
            font-size: 12px;
            color: #b00020;
            padding: 8px;
            background: #ffebee;
            border-radius: 6px;
        }

        .step small {
             font-size: 10px;
             color: #757575;
             margin-bottom: 5px;
             display: block;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {
            .art-card {
                flex-direction: column;
            }
            .art-image {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>ArtMix â€“ ë¯¸ìˆ  ì‘í’ˆ ì¶”ì²œ ë‹¨ê³„ë³„ í•„í„° ë° ê°œì¸ ê³µê°„</h1>
        <p>ë‹¨ê³„ë³„ í•„í„°ë§, ì»¬ë ‰ì…˜, ì—°ì† ê°ìƒ, ì·¨í–¥ ê¸°ë°˜ ì¶”ì²œ, ê·¸ë¦¬ê³  ì§ì ‘ ì‘í’ˆ ì¶”ê°€ ê¸°ëŠ¥ì„ í†µí•©í•œ ë¯¸ìˆ  í”Œë«í¼ í”„ë¡œí† íƒ€ì…ì…ë‹ˆë‹¤.</p>
    </header>

<main class="app-container">
    <div class="main-content">
        <div class="step panel" id="step1">
            <h2>1. ì„œì–‘ë¯¸ìˆ  / ë™ì–‘ë¯¸ìˆ  ì„ íƒ</h2>
            <small>ë¨¼ì € ì „ì²´ì ì¸ íë¦„ì„ ì •í•´ìš”.</small>
            <label for="traditionSelect">ë¯¸ìˆ  ë²”ì£¼</label>
            <select id="traditionSelect">
                <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
                <option value="ì„œì–‘">ì„œì–‘ë¯¸ìˆ </option>
                <option value="ë™ì–‘">ë™ì–‘ë¯¸ìˆ </option>
            </select>
        </div>

        <div class="step hidden panel" id="stepRegion">
            <h2>1-2. ë™ì–‘ ë¯¸ìˆ  ì„¸ë¶€ ì„ íƒ</h2>
            <small>ë™ì–‘ ë¯¸ìˆ ì„ ì„ íƒí–ˆë‹¤ë©´, ì§€ì—­ì„ ê³ ë¥´ì„¸ìš”.</small>
            <label for="regionSelect">ì§€ì—­</label>
            <select id="regionSelect">
                <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
                <option value="í•œêµ­">í•œêµ­</option>
                <option value="ì¤‘êµ­">ì¤‘êµ­</option>
                <option value="ì¼ë³¸">ì¼ë³¸</option>
            </select>
        </div>

        <div class="step hidden panel" id="stepEra">
            <h2>2. ì‘í’ˆì˜ ì‹œëŒ€ ì„ íƒ</h2>
            <small>ì„ íƒí•œ ë²”ì£¼ ì•ˆì—ì„œ í•´ë‹¹í•˜ëŠ” ì‹œëŒ€ë§Œ ë³´ì—¬ì¤˜ìš”. (âŒ˜ ë˜ëŠ” Ctrl í‚¤ë¡œ ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</small>
            <label for="eraSelect">ì‹œëŒ€</label>
            <select id="eraSelect" multiple size="6">
                <option value="__ALL__">ì „ì²´ ì„ íƒ</option>
            </select>
        </div>

        <div class="step hidden panel" id="stepMaterial">
            <h2>3. ì¬ë£Œ ë° ê¸°ë²• ì„ íƒ</h2>
            <small>í¬ê²Œ ì–´ë–¤ ì¬ë£Œ/í˜•ì‹ì„ ê°€ì§„ ì‘í’ˆì´ ì¢‹ì€ì§€ ê³¨ë¼ë³´ì„¸ìš”. (âŒ˜ ë˜ëŠ” Ctrl í‚¤ë¡œ ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</small>
            <label for="materialSelect">ì¬ë£Œ / í˜•ì‹</label>
            <select id="materialSelect" multiple size="6">
                <option value="__ALL__">ì „ì²´ ì„ íƒ</option>
            </select>
        </div>

        <div class="step hidden panel" id="stepArtist">
            <h2>4. ì‘ê°€ ì„ íƒ</h2>
            <small>ì•ì—ì„œ ê³ ë¥¸ ì¡°ê±´ ì•ˆì— ë“¤ì–´ê°€ëŠ” ì‘ê°€ë§Œ ë‚˜ì™€ìš”. (âŒ˜ ë˜ëŠ” Ctrl í‚¤ë¡œ ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</small>
            <label for="artistSelect">ì‘ê°€</label>
            <select id="artistSelect" multiple size="6">
                <option value="__ALL__">ì „ì²´ ì„ íƒ</option>
            </select>
        </div>

        <div class="step hidden panel" id="stepKeyword">
            <h2>5. ì¶”ê°€ í‚¤ì›Œë“œ (ì„ íƒ)</h2>
            <small>ë¶„ìœ„ê¸°, ì£¼ì œ ë“±ì„ í•´ì‹œíƒœê·¸ì²˜ëŸ¼ ì ì–´ë„ ì¢‹ì•„ìš”. ì˜ˆ: #ì¢…êµ #ì¸ì²´ #í’ê²½</small>
            <label for="keywordInput">í‚¤ì›Œë“œ</label>
            <input type="text" id="keywordInput" placeholder="ì‘í’ˆ ì´ë¦„, ì‘ê°€, ë‚´ìš©, í•´ì‹œíƒœê·¸ ë“±ìœ¼ë¡œ ê²€ìƒ‰">
            <div class="button-row" style="margin-top:12px;">
                <button class="btn btn-primary" id="recommendBtn">ì¶”ì²œ ê²°ê³¼ ë³´ê¸°</button>
            </div>
        </div>

        <div id="resultContainer" class="result panel hidden">
            <div class="result-header">
                <h2>âœ¨ ì¶”ì²œ ì‘í’ˆ ê²°ê³¼</h2>
            </div>
            <div class="filters-summary" id="filtersSummary"></div>
            <div id="resultContent"></div>

            <div class="back-controls">
                <button class="btn btn-secondary" id="resetBtn">ğŸ” ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
                <label for="goBackSelect">ë˜ëŠ” ì´ ë‹¨ê³„ë¡œ ëŒì•„ê°€ê¸°:</label>
                <select id="goBackSelect">
                    <option value="">ë‹¨ê³„ ì„ íƒ</option>
                    <option value="1">1ë‹¨ê³„ - ì„œì–‘/ë™ì–‘ ì„ íƒ</option>
                    <option value="1-2">1-2ë‹¨ê³„ - ì§€ì—­ ì„ íƒ</option>
                    <option value="2">2ë‹¨ê³„ - ì‹œëŒ€ ì„ íƒ</option>
                    <option value="3">3ë‹¨ê³„ - ì¬ë£Œ/ê¸°ë²• ì„ íƒ</option>
                    <option value="4">4ë‹¨ê³„ - ì‘ê°€ ì„ íƒ</option>
                    <option value="5">5ë‹¨ê³„ - í‚¤ì›Œë“œ ì…ë ¥</option>
                </select>
            </div>
        </div>
    </div>
    
    <section class="panel">
        <h2>ë‚˜ë§Œì˜ ê³µê°„</h2>
        <div class="subtitle">ì»¬ë ‰ì…˜, ì—°ì† ê°ìƒ, ìµœê·¼ ë³¸ ì‘í’ˆ, ì·¨í–¥ ê¸°ë°˜ ì¶”ì²œ, ì§ì ‘ ì‘í’ˆ ì¶”ê°€</div>

        <div>
            <div class="mini-section-title">ë‚´ ì»¬ë ‰ì…˜</div>
            <ul id="collectionList" class="list-small">
                <li>ì•„ì§ ì¶”ê°€ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</li>
            </ul>
            <!-- âœ… ì»¬ë ‰ì…˜ ë¹„ìš°ê¸° ë²„íŠ¼ ì¶”ê°€ -->
            <div class="button-row">
                <button class="btn btn-secondary" onclick="clearCollection()">ì»¬ë ‰ì…˜ ë¹„ìš°ê¸°</button>
            </div>
        </div>

        <div>
            <div class="mini-section-title">ì—°ì† ê°ìƒ (í”Œë ˆì´ë¦¬ìŠ¤íŠ¸)</div>
            <ul id="playlist" class="list-small">
                <li>ì¬ìƒí•  ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</li>
            </ul>
            <div class="button-row">
                <button class="btn btn-primary" onclick="playNext()">ë‹¤ìŒ ì‘í’ˆ ê°ìƒ</button>
                <button class="btn btn-secondary" onclick="clearPlaylist()">í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¹„ìš°ê¸°</button>
            </div>
            <p id="nowPlaying" class="subtitle" style="margin-top:6px;">í˜„ì¬ ê°ìƒ ì¤‘: -</p>
        </div>

        <div>
            <div class="mini-section-title">ìµœê·¼ ë³¸ ì‘í’ˆ</div>
            <p id="lastViewed" class="subtitle">ì•„ì§ ê°ìƒí•œ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤. ì‘í’ˆ ì¹´ë“œì˜ ì´ë¯¸ì§€ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”.</p>
        </div>

        <div>
            <div class="mini-section-title">ë‚´ ì·¨í–¥ ê¸°ë°˜ ì¶”ì²œ (ê°„ë‹¨ ë²„ì „)</div>
            <p class="subtitle">
                ë‚´ ì»¬ë ‰ì…˜ê³¼ ìµœê·¼ ë³¸ ì‘í’ˆì˜ ê°ê° íƒœê·¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë¹„ìŠ·í•œ íƒœê·¸ë¥¼ ê°€ì§„ ì‘í’ˆì„ ì ìˆ˜ë¡œ ì¶”ì²œí•©ë‹ˆë‹¤.
            </p>
            <ul id="recommendList" class="list-small">
                <li>ì•„ì§ ë°ì´í„°ê°€ ì—†ì–´ ì¶”ì²œì„ ê³„ì‚°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
            </ul>
            <button class="btn btn-secondary" onclick="updateRecommendations()">ì¶”ì²œ ë‹¤ì‹œ ê³„ì‚°</button>
        </div>

        <!-- ğŸ”½ ì‘í’ˆ ì¶”ê°€ í¼ (ë²”ì£¼/ì‹œëŒ€/ì¬ë£Œ ì¶”ê°€ ë²„ì „) -->
        <div>
            <div class="mini-section-title">ì‘í’ˆ ì¶”ê°€</div>
            <p class="subtitle">
                ì§ì ‘ ìƒˆë¡œìš´ ì‘í’ˆì„ ë°ì´í„°ì— ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”.<br>
                ì™¼ìª½ í•„í„°ì—ì„œ ê³ ë¥¸ ê°’ë“¤ì´ ìˆë‹¤ë©´, ì…ë ¥ì„ ë¹„ì›Œë‘ë©´ ê·¸ ê°’ì´ ìë™ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
            </p>

            <label for="newTitle">ì œëª©</label>
            <input id="newTitle" type="text" placeholder="ì˜ˆ: ë‚˜ë§Œì˜ ì‘í’ˆ ì œëª©" />

            <label for="newArtist">ì‘ê°€</label>
            <input id="newArtist" type="text" placeholder="ì˜ˆ: í™ê¸¸ë™" />

            <label for="newTradition">ë¯¸ìˆ  ë²”ì£¼ (ì„œì–‘/ë™ì–‘)</label>
            <select id="newTradition">
                <option value="">(í˜„ì¬ ì„ íƒê°’ ì‚¬ìš© ë˜ëŠ” ê¸°ë³¸ê°’)</option>
                <option value="ì„œì–‘">ì„œì–‘ë¯¸ìˆ </option>
                <option value="ë™ì–‘">ë™ì–‘ë¯¸ìˆ </option>
            </select>

            <label for="newEra">ì‹œëŒ€</label>
            <input id="newEra" type="text" placeholder="ì˜ˆ: ë¥´ë„¤ìƒìŠ¤, ì¡°ì„  í›„ê¸°, í˜„ëŒ€ ë“±" />

            <label for="newMaterial">ì¬ë£Œ ë° ê¸°ë²•</label>
            <input id="newMaterial" type="text" placeholder="ì˜ˆ: ìœ í™”, ì§€ë³¸ ìˆ˜ë¬µë‹´ì±„, ëª©íŒí™” ë“±" />

            <label for="newTags">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
            <input id="newTags" type="text" placeholder="ì˜ˆ: ìˆ˜ë¬µí™”, ì„œì •ì , ì‚°ìˆ˜" />

            <label for="newImage">ì´ë¯¸ì§€ URL (ì„ íƒ)</label>
            <input id="newImage" type="text" placeholder="ì´ë¯¸ì§€ ë§í¬ë¥¼ ë„£ì§€ ì•Šìœ¼ë©´ ìë™ í”Œë ˆì´ìŠ¤í™€ë”ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤." />

            <div class="button-row">
                <button class="btn btn-primary" onclick="addArtwork()">ì‘í’ˆ ì¶”ê°€</button>
            </div>
        </div>
        <!-- ğŸ”¼ ì‘í’ˆ ì¶”ê°€ í¼ ë -->
    </section>
</main>

    <footer>
        <p style="text-align: center; font-size: 11px; color: #757575; padding-top: 10px;">
            ArtMix ìŠ¤íƒ€ì¼ë¡œ ì¬êµ¬ì„±ëœ ë¯¸ìˆ  ì‘í’ˆ ì¶”ì²œ í”„ë¡œê·¸ë¨ + ì‚¬ìš©ì ì‘í’ˆ ì¶”ê°€ ê¸°ëŠ¥
        </p>
    </footer>
    <footer>
        <p style="text-align: center; font-size: 11px; color: #757575; padding-top: 10px;">
            ArtMix ìŠ¤íƒ€ì¼ë¡œ ì¬êµ¬ì„±ëœ ë¯¸ìˆ  ì‘í’ˆ ì¶”ì²œ í”„ë¡œê·¸ë¨ + ì‚¬ìš©ì ì‘í’ˆ ì¶”ê°€ ê¸°ëŠ¥
        </p>
    </footer>

    <!-- âœ… Firebase SDK ë¶ˆëŸ¬ì˜¤ê¸° (compat ë²„ì „, npm í•„ìš” ì—†ìŒ) -->
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore-compat.js"></script>

    <!-- âœ… Firebase ì´ˆê¸°í™” -->
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBzsYHu7a07d9hsSdSHRg7_ASuVE9DlOFI",
        authDomain: "artmix-app.firebaseapp.com",
        projectId: "artmix-app",
        storageBucket: "artmix-app.firebasestorage.app",
        messagingSenderId: "323550477860",
        appId: "1:323550477860:web:2bf6c78fda56d0dca548b1",
        measurementId: "G-R76GB4HHKK"
      };

      firebase.initializeApp(firebaseConfig);
      // ì „ì—­ì—ì„œ ì“¸ Firestore ê°ì²´
      const db = firebase.firestore();
    </script>

    <!-- âœ… ê¸°ì¡´ ì•± ë¡œì§ + Firestore ì—°ë™ -->
    <script>
    // ====== ìƒ˜í”Œ ì‘í’ˆ ë°ì´í„° (ê¸°ì¡´ ë°°ì—´) ======
    const artworks = [
        {
            "id": 1,
            "title": "ë¹—ì‚´ë¬´ëŠ¬í† ê¸°",
            "artist": "ë¯¸ìƒ",
            "tradition": "ë™ì–‘",
            "region": "í•œêµ­",
            "eraMain": "ì‹ ì„ê¸°",
            "material": "í† ê¸°, ì„ ê° ë¬´ëŠ¬",
            "year": "ê¸°ì›ì „ 4000â€“3000",
            "image": "https://via.placeholder.com/400x250?text=ë¹—ì‚´ë¬´ëŠ¬í† ê¸°",
            "description": "ì‹ ì„ê¸° ëŒ€í‘œ í† ê¸°, ë¹—ì‚´ë¬´ëŠ¬ ì¥ì‹",
            "hashtags": ["í† ê¸°", "ì‹ ì„ê¸°", "ì„ ì‚¬", "í•œêµ­"],
            "senseTags": ["ë‹¨ìˆœ", "ê±°ì¹œ", "ì—­ë™ì "]
        },
        {
            "id": 49,
            "title": "ëª½ìœ ë„ì›ë„",
            "artist": "ì•ˆê²¬",
            "tradition": "ë™ì–‘",
            "region": "í•œêµ­",
            "eraMain": "ì¡°ì„  ì „ê¸°",
            "material": "ì§€ë³¸ ìˆ˜ë¬µë‹´ì±„",
            "year": "1447 ì¶”ì •",
            "image": "https://via.placeholder.com/400x250?text=ëª½ìœ ë„ì›ë„",
            "description": "ì´ìƒí–¥ ë„ì›, ê¶ì¤‘ í™”ì› ëŒ€í‘œì‘",
            "hashtags": ["íšŒí™”", "ìˆ˜ë¬µë‹´ì±„", "ì¡°ì„ ", "ì´ìƒí–¥", "ì•ˆê²¬", "í•œêµ­"],
            "senseTags": ["ëª½í™˜ì ", "ì„œì •ì ", "ë¶€ë“œëŸ¬ì›€"]
        },
        {
            "id": 55,
            "title": "ì¸ì™•ì œìƒ‰ë„",
            "artist": "ì •ì„ ",
            "tradition": "ë™ì–‘",
            "region": "í•œêµ­",
            "eraMain": "ì¡°ì„  í›„ê¸°",
            "material": "ìˆ˜ë¬µë‹´ì±„",
            "year": "1751",
            "image": "https://via.placeholder.com/400x250?text=ì¸ì™•ì œìƒ‰ë„",
            "description": "ì„œìš¸ ì¸ì™•ì‚° ì‹¤ê²½, ì§„ê²½ì‚°ìˆ˜ ì ˆì •",
            "hashtags": ["íšŒí™”", "ìˆ˜ë¬µë‹´ì±„", "ì¡°ì„ ", "ì§„ê²½ì‚°ìˆ˜", "ì •ì„ ", "í•œêµ­"],
            "senseTags": ["ì—­ë™ì ", "ì°¨ê°€ìš´", "ê·¹ì "]
        },
        {
            "id": 61,
            "title": "ì”¨ë¦„",
            "artist": "ê¹€í™ë„",
            "tradition": "ë™ì–‘",
            "region": "í•œêµ­",
            "eraMain": "ì¡°ì„  í›„ê¸°",
            "material": "ìˆ˜ë¬µë‹´ì±„",
            "year": "18C í›„ë°˜",
            "image": "https://via.placeholder.com/400x250?text=ì”¨ë¦„",
            "description": "ì—­ë™ì  í’ì†, ì„œë¯¼ ë¬¸í™”",
            "hashtags": ["íšŒí™”", "í’ì†í™”", "ì¡°ì„ ", "ì”¨ë¦„", "ê¹€í™ë„", "í•œêµ­", "ì—­ë™ì "],
            "senseTags": ["ì—­ë™ì ", "ë”°ëœ»í•œ", "í•´í•™"]
        },
        {
            "id": 150,
            "title": "í›„ê°€ì¿  36ê²½ â€“ ê°€ë‚˜ê°€ì™€ì˜ í° íŒŒë„",
            "artist": "ê°€ì“°ì‹œì¹´ í˜¸ì¿ ì‚¬ì´",
            "tradition": "ë™ì–‘",
            "region": "ì¼ë³¸",
            "eraMain": "ì—ë„ì‹œëŒ€",
            "material": "ëª©íŒí™”",
            "year": "1831",
            "image": "https://via.placeholder.com/400x250?text=í›„ê°€ì¿ %2036ê²½%20â€“%20ê°€ë‚˜ê°€ì™€ì˜%20í°%20íŒŒë„",
            "description": "ìš°í‚¤ìš”ì— ì ˆì •, ë™ì„¸ì™€ ìƒ‰ì±„ ê°•ì¡°",
            "hashtags": ["ëª©íŒí™”", "ìš°í‚¤ìš”ì—", "ì—ë„", "íŒŒë„", "í˜¸ì¿ ì‚¬ì´", "ì¼ë³¸", "ì—­ë™ì "],
            "senseTags": ["ê·¸ë¡œí…ŒìŠ¤í¬", "ì°¨ê°€ìš´", "ì—­ë™ì "]
        },
        {
            "id": 171,
            "title": "ëª¨ë‚˜ë¦¬ì",
            "artist": "ë ˆì˜¤ë‚˜ë¥´ë„ ë‹¤ ë¹ˆì¹˜",
            "tradition": "ì„œì–‘",
            "region": "ì„œì–‘",
            "eraMain": "ë¥´ë„¤ìƒìŠ¤",
            "material": "ìœ í™”",
            "year": "1503ê²½",
            "image": "https://via.placeholder.com/400x250?text=ëª¨ë‚˜ë¦¬ì",
            "description": "ìŠ¤í‘¸ë§ˆí†  ê¸°ë²•",
            "hashtags": ["íšŒí™”", "ìœ í™”", "ë¥´ë„¤ìƒìŠ¤", "ë‹¤ë¹ˆì¹˜", "ì´ˆìƒí™”", "ìœ ëŸ½"],
            "senseTags": ["ì‹ ë¹„", "ë¶€ë“œëŸ¬ì›€", "ë”°ëœ»í•œ"]
        },
        {
            "id": 184,
            "title": "ì•¼ê²½",
            "artist": "ë ˜ë¸Œë€íŠ¸",
            "tradition": "ì„œì–‘",
            "region": "ì„œì–‘",
            "eraMain": "ë°”ë¡œí¬",
            "material": "ìœ í™”",
            "year": "1642",
            "image": "https://via.placeholder.com/400x250?text=ì•¼ê²½",
            "description": "ëª…ì•” ëŒ€ë¹„Â·ì§‘ë‹¨ ì´ˆìƒ",
            "hashtags": ["íšŒí™”", "ìœ í™”", "ë°”ë¡œí¬", "ë ˜ë¸Œë€íŠ¸", "ëª…ì•”", "ìœ ëŸ½", "ì–´ë‘ìš´"],
            "senseTags": ["ê·¹ì ", "ì–´ë‘ìš´", "ì°¨ê°€ìš´"]
        },
        {
            "id": 227,
            "title": "ë³„ì´ ë¹›ë‚˜ëŠ” ë°¤",
            "artist": "ê³ í",
            "tradition": "ì„œì–‘",
            "region": "ì„œì–‘",
            "eraMain": "í›„ê¸° ì¸ìƒì£¼ì˜",
            "material": "ìœ í™”",
            "year": "1889",
            "image": "https://via.placeholder.com/400x250?text=ë³„ì´%20ë¹›ë‚˜ëŠ”%20ë°¤",
            "description": "í‘œí˜„ì  í•˜ëŠ˜",
            "hashtags": ["íšŒí™”", "ìœ í™”", "í›„ê¸°ì¸ìƒì£¼ì˜", "ê³ í", "í•˜ëŠ˜", "ìœ ëŸ½", "ëª½í™˜ì ", "ë¶ˆì•ˆí•œ"],
            "senseTags": ["ëª½í™˜ì ", "ë¶ˆì•ˆí•œ", "ì—­ë™ì ", "ì°¨ê°€ìš´"]
        },
        {
            "id": 251,
            "title": "ê¸°ì–µì˜ ì§€ì†",
            "artist": "ë‹¬ë¦¬",
            "tradition": "ì„œì–‘",
            "region": "ì„œì–‘",
            "eraMain": "ì „ìœ„ë¯¸ìˆ ",
            "material": "ìœ í™”",
            "year": "1931",
            "image": "https://via.placeholder.com/400x250?text=ê¸°ì–µì˜%20ì§€ì†",
            "description": "ë…¹ëŠ” ì‹œê³„",
            "hashtags": ["íšŒí™”", "ìœ í™”", "ì „ìœ„ë¯¸ìˆ ", "ë‹¬ë¦¬", "ì´ˆí˜„ì‹¤ì£¼ì˜", "ëª½í™˜ì ", "ìœ ëŸ½"],
            "senseTags": ["ëª½í™˜ì ", "ì‹ ë¹„", "ê·¸ë¡œí…ŒìŠ¤í¬", "ì„œì •ì "]
        },
        {
            "id": 258,
            "title": "ìº ë²¨ ìˆ˜í”„ ìº”",
            "artist": "ì›Œí™€",
            "tradition": "ì„œì–‘",
            "region": "ì„œì–‘",
            "eraMain": "ì „ìœ„ë¯¸ìˆ ",
            "material": "ì‹¤í¬ìŠ¤í¬ë¦°",
            "year": "1962",
            "image": "https://via.placeholder.com/400x250?text=ìº ë²¨%20ìˆ˜í”„%20ìº”",
            "description": "ì†Œë¹„ë¬¸í™”",
            "hashtags": ["íšŒí™”", "ì‹¤í¬ìŠ¤í¬ë¦°", "ì „ìœ„ë¯¸ìˆ ", "ì›Œí™€", "íŒì•„íŠ¸", "ì†Œë¹„", "ë¯¸êµ­"],
            "senseTags": ["ë‹¨ìˆœ", "ì°¨ê°€ìš´", "ëŒ€ì¤‘ì "]
        }
    ];

    const state = {
        tradition: "",
        region: "",
        eraMain: [],	
        material: [],	
        artist: []	
    };

    let collection = [];
    let playlist = [];
    let lastViewedId = null;

    const els = {
        step1: document.getElementById("step1"),
        stepRegion: document.getElementById("stepRegion"),
        stepEra: document.getElementById("stepEra"),
        stepMaterial: document.getElementById("stepMaterial"),
        stepArtist: document.getElementById("stepArtist"),
        stepKeyword: document.getElementById("stepKeyword"),
        traditionSelect: document.getElementById("traditionSelect"),
        regionSelect: document.getElementById("regionSelect"),
        eraSelect: document.getElementById("eraSelect"),
        materialSelect: document.getElementById("materialSelect"),
        artistSelect: document.getElementById("artistSelect"),
        keywordInput: document.getElementById("keywordInput"),
        recommendBtn: document.getElementById("recommendBtn"),
        resultContainer: document.getElementById("resultContainer"),
        resultContent: document.getElementById("resultContent"),
        filtersSummary: document.getElementById("filtersSummary"),
        resetBtn: document.getElementById("resetBtn"),
        goBackSelect: document.getElementById("goBackSelect"),
        collectionListEl: document.getElementById("collectionList"),
        playlistEl: document.getElementById("playlist"),
        nowPlayingEl: document.getElementById("nowPlaying"),
        recommendListEl: document.getElementById("recommendList"),
        lastViewedEl: document.getElementById("lastViewed")
    };

    function show(el) { el.classList.remove("hidden"); }
    function hide(el) { el.classList.add("hidden"); }

    function resetSelect(selectEl, placeholder) {
        selectEl.innerHTML = "";
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = placeholder || "-- ì„ íƒí•˜ì„¸ìš” --";
        selectEl.appendChild(opt);
        
        if (selectEl.hasAttribute('multiple')) {
            const allOpt = document.createElement("option");
            allOpt.value = "__ALL__";
            allOpt.textContent = "ì „ì²´ ì„ íƒ";
            selectEl.appendChild(allOpt);
            Array.from(selectEl.options).forEach(opt => opt.selected = false);
        }
        selectEl.value = "";
    }

    function getSelectedValues(selectEl) {
        const selected = Array.from(selectEl.selectedOptions).map(o => o.value);
        if (selected.includes("__ALL__")) {
            return Array.from(selectEl.options)
                .map(o => o.value)
                .filter(v => v !== "" && v !== "__ALL__");
        }
        return selected.filter(v => v !== "" && v !== "__ALL__");
    }

    function filterArtworks(filterStep) {
        return artworks.filter(a => {
            if (state.tradition && a.tradition !== state.tradition) return false;
            if (state.tradition === "ë™ì–‘" && state.region && a.region !== state.region) return false;
            if (filterStep >= 2 && state.eraMain.length && !state.eraMain.includes(a.eraMain)) return false;
            if (filterStep >= 3 && state.material.length && !state.material.includes(a.material)) return false;
            if (filterStep >= 4 && state.artist.length && !state.artist.includes(a.artist)) return false;
            return true;
        });
    }

    function populateEraOptions() {
        const list = filterArtworks(1);
        const eras = Array.from(new Set(list.map(a => a.eraMain))).filter(e => e);
        resetSelect(els.eraSelect, "-- ì‹œëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš” --");

        eras.forEach(e => {
            const opt = document.createElement("option");
            opt.value = e;
            opt.textContent = e;
            els.eraSelect.appendChild(opt);
        });
        state.eraMain = [];
        hide(els.stepMaterial);
        hide(els.stepArtist);
        hide(els.stepKeyword);
        hide(els.resultContainer);
    }

    function populateMaterialOptions() {
        const list = filterArtworks(2);
        const materials = Array.from(new Set(list.map(a => a.material))).filter(m => m);
        resetSelect(els.materialSelect, "-- ì¬ë£Œ/í˜•ì‹ì„ ì„ íƒí•˜ì„¸ìš” --");

        materials.forEach(m => {
            const opt = document.createElement("option");
            opt.value = m;
            opt.textContent = m;
            els.materialSelect.appendChild(opt);
        });
        state.material = [];
        hide(els.stepArtist);
        hide(els.stepKeyword);
        hide(els.resultContainer);
    }

    function populateArtistOptions() {
        const list = filterArtworks(3);
        const artists = Array.from(new Set(list.map(a => a.artist))).filter(ar => ar);
        resetSelect(els.artistSelect, "-- ì‘ê°€ë¥¼ ì„ íƒí•˜ì„¸ìš” --");

        artists.forEach(ar => {
            const opt = document.createElement("option");
            opt.value = ar;
            opt.textContent = ar;
            els.artistSelect.appendChild(opt);
        });
        state.artist = [];
        hide(els.stepKeyword);
        hide(els.resultContainer);
    }

    function updateFiltersSummary() {
        const parts = [];
        if (state.tradition) parts.push(`**ë²”ì£¼:** ${state.tradition === "ì„œì–‘" ? "ì„œì–‘ë¯¸ìˆ " : "ë™ì–‘ë¯¸ìˆ "}`);
        if (state.tradition === "ë™ì–‘" && state.region) parts.push(`**ì§€ì—­:** ${state.region}`);
        if (state.eraMain.length) parts.push(`**ì‹œëŒ€:** ${state.eraMain.join(", ")}`);
        if (state.material.length) parts.push(`**ì¬ë£Œ/í˜•ì‹:** ${state.material.join(", ")}`);
        if (state.artist.length) parts.push(`**ì‘ê°€:** ${state.artist.join(", ")}`);
        const keyword = els.keywordInput.value.trim();
        if (keyword) parts.push(`**í‚¤ì›Œë“œ:** "${keyword}"`);
        els.filtersSummary.innerHTML = parts.join(" &nbsp; | &nbsp; ");
    }

    function showResults() {
        let list = filterArtworks(4);
        const keywordRaw = els.keywordInput.value.trim();
        const keyword = keywordRaw.replace(/#/g, "").toLowerCase();

        if (keyword) {
            list = list.filter(a => {
                const text = [
                    a.title,
                    a.artist,
                    a.description,
                    (a.hashtags || []).join(" ")
                ].join(" ").toLowerCase();
                return text.indexOf(keyword) !== -1;
            });
        }

        updateFiltersSummary();
        els.resultContent.innerHTML = "";

        if (list.length === 0) {
            const div = document.createElement("div");
            div.className = "no-result";
            div.textContent = "ì¡°ê±´ì— ë§ëŠ” ì‘í’ˆì„ ì°¾ì§€ ëª»í–ˆì–´ìš”. í‚¤ì›Œë“œë¥¼ ë¹„ìš°ê±°ë‚˜ ìƒìœ„ ë‹¨ê³„ë¥¼ ë‹¤ì‹œ ì„ íƒí•´ ë³´ì„¸ìš”.";
            els.resultContent.appendChild(div);
            show(els.resultContainer);
            return;
        }

        list.forEach(a => {
            const card = document.createElement("div");
            card.className = "art-card";

            const imgWrap = document.createElement("div");
            imgWrap.className = "art-image";
            const img = document.createElement("img");
            img.src = a.image;
            img.alt = a.title;
            img.onclick = () => viewArtwork(a.id);
            imgWrap.appendChild(img);

            const info = document.createElement("div");
            info.className = "art-info";

            const h3 = document.createElement("h3");
            h3.textContent = `${a.title} (${a.year || "ì—°ë„ ë¯¸ìƒ"})`;
            info.appendChild(h3);

            const meta = document.createElement("p");
            meta.innerHTML = `<strong>ì‘ê°€:</strong> ${a.artist} / <strong>ì‹œëŒ€:</strong> ${a.eraMain || "-"} / <strong>ì¬ë£Œ:</strong> ${a.material || "-"}`;
            info.appendChild(meta);

            const desc = document.createElement("p");
            desc.textContent = a.description || "";
            info.appendChild(desc);

            if (a.hashtags && a.hashtags.length > 0) {
                const chips = document.createElement("div");
                chips.className = "chips";
                a.hashtags.forEach(tag => {
                    const span = document.createElement("span");
                    span.className = "hashtag";
                    span.textContent = `#${tag}`;
                    chips.appendChild(span);
                });
                info.appendChild(chips);
            }
            
            const btnRow = document.createElement("div");
            btnRow.className = "button-row";
            btnRow.style.marginTop = "6px";
            
            const btnCollection = document.createElement("button");
            btnCollection.className = "btn btn-secondary";
            btnCollection.textContent = "ì»¬ë ‰ì…˜ì— ì¶”ê°€";
            btnCollection.onclick = () => addToCollection(a.id);

            const btnPlaylist = document.createElement("button");
            btnPlaylist.className = "btn btn-primary";
            btnPlaylist.textContent = "ì—°ì† ê°ìƒì— ì¶”ê°€";
            btnPlaylist.onclick = () => addToPlaylist(a.id);

            btnRow.appendChild(btnCollection);
            btnRow.appendChild(btnPlaylist);
            info.appendChild(btnRow);
            
            card.appendChild(imgWrap);
            card.appendChild(info);

            els.resultContent.appendChild(card);
        });

        show(els.resultContainer);
    }

    function resetAll() {
        state.tradition = "";
        state.region = "";
        state.eraMain = [];
        state.material = [];
        state.artist = [];
        els.traditionSelect.value = "";
        els.regionSelect.value = "";
        resetSelect(els.eraSelect, "-- ì‹œëŒ€ë¥¼ ì„ íƒí•˜ì„¸ìš” --");
        resetSelect(els.materialSelect, "-- ì¬ë£Œ/í˜•ì‹ì„ ì„ íƒí•˜ì„¸ìš” --");
        resetSelect(els.artistSelect, "-- ì‘ê°€ë¥¼ ì„ íƒí•˜ì„¸ìš” --");
        els.keywordInput.value = "";
        hide(els.stepRegion);
        hide(els.stepEra);
        hide(els.stepMaterial);
        hide(els.stepArtist);
        hide(els.stepKeyword);
        hide(els.resultContainer);
        els.goBackSelect.value = "";
    }

    function goBackTo(step) {
        hide(els.resultContainer);
        switch (step) {
            case "1":
                resetAll();
                break;
            case "1-2":
                state.region = "";
                state.eraMain = [];
                state.material = [];
                state.artist = [];
                els.regionSelect.value = "";
                els.eraSelect.selectedIndex = -1;
                els.materialSelect.selectedIndex = -1;
                els.artistSelect.selectedIndex = -1;
                els.keywordInput.value = "";
                show(els.stepRegion);
                hide(els.stepEra);
                hide(els.stepMaterial);
                hide(els.stepArtist);
                hide(els.stepKeyword);
                break;
            case "2":
                state.eraMain = [];
                state.material = [];
                state.artist = [];
                els.eraSelect.selectedIndex = -1;
                els.materialSelect.selectedIndex = -1;
                els.artistSelect.selectedIndex = -1;
                els.keywordInput.value = "";
                show(els.stepEra);
                hide(els.stepMaterial);
                hide(els.stepArtist);
                hide(els.stepKeyword);
                populateEraOptions();
                break;
            case "3":
                state.material = [];
                state.artist = [];
                els.materialSelect.selectedIndex = -1;
                els.artistSelect.selectedIndex = -1;
                els.keywordInput.value = "";
                show(els.stepMaterial);
                hide(els.stepArtist);
                hide(els.stepKeyword);
                state.eraMain = getSelectedValues(els.eraSelect); 
                populateMaterialOptions();
                break;
            case "4":
                state.artist = [];
                els.artistSelect.selectedIndex = -1;
                els.keywordInput.value = "";
                show(els.stepArtist);
                hide(els.stepKeyword);
                state.material = getSelectedValues(els.materialSelect); 
                populateArtistOptions();
                break;
            case "5":
                show(els.stepKeyword);
                break;
        }
        els.goBackSelect.value = "";
    }

    // ===== ë‚˜ë§Œì˜ ê³µê°„ ë¡œì§ =====
    function getArt(id) {
        return artworks.find(a => a.id === id);
    }
    
    function addToCollection(id) {
        if (collection.indexOf(id) === -1) {
            collection.push(id);
            updateCollectionView();
            updateRecommendations();
        }
    }

    function updateCollectionView() {
        els.collectionListEl.innerHTML = "";
        if (collection.length === 0) {
            els.collectionListEl.innerHTML = "<li>ì•„ì§ ì¶”ê°€ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</li>";
            return;
        }
        collection.forEach(id => {
            const art = getArt(id);
            if (!art) return;
            const li = document.createElement("li");
            li.textContent = `${art.title} (${art.artist})`;
            els.collectionListEl.appendChild(li);
        });
    }

    function addToPlaylist(id) {
        playlist.push(id);
        updatePlaylistView();
    }

    function updatePlaylistView() {
        els.playlistEl.innerHTML = "";
        if (playlist.length === 0) {
            els.playlistEl.innerHTML = "<li>ì¬ìƒí•  ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</li>";
            return;
        }
        playlist.forEach((id, index) => {
            const art = getArt(id);
            if (!art) return;
            const li = document.createElement("li");
            li.textContent = `${index + 1}. ${art.title} - ${art.artist}`;
            els.playlistEl.appendChild(li);
        });
    }

    function playNext() {
        if (playlist.length === 0) {
            els.nowPlayingEl.textContent = "í˜„ì¬ ê°ìƒ ì¤‘: -";
            return;
        }
        const nextId = playlist.shift();
        const art = getArt(nextId);
        if (!art) {
            updatePlaylistView();
            return;
        }
        els.nowPlayingEl.textContent = `í˜„ì¬ ê°ìƒ ì¤‘: ${art.title} (${art.artist})`;
        viewArtwork(nextId);
        updatePlaylistView();
    }

    function clearPlaylist() {
        playlist = [];
        updatePlaylistView();
        els.nowPlayingEl.textContent = "í˜„ì¬ ê°ìƒ ì¤‘: -";
    }

    function viewArtwork(id) {
        const art = getArt(id);
        if (!art) return;
        lastViewedId = id;
        els.lastViewedEl.textContent = `${art.title} (${art.artist}, ${art.year || "ì—°ë„ ë¯¸ìƒ"}) â€“ ${art.description || ""}`;
        updateRecommendations();
    }
    
    function updateRecommendations() {
        els.recommendListEl.innerHTML = "";

        const tagCount = {};

        collection.forEach(id => {
            const art = getArt(id);
            if (!art) return;
            (art.senseTags || []).forEach(tag => {
                tagCount[tag] = (tagCount[tag] || 0) + 1;
            });
        });

        if (lastViewedId !== null) {
            const art = getArt(lastViewedId);
            if (art) {
                (art.senseTags || []).forEach(tag => {
                    tagCount[tag] = (tagCount[tag] || 0) + 2;
                });
            }
        }

        if (Object.keys(tagCount).length === 0) {
            els.recommendListEl.innerHTML = "<li>ì»¬ë ‰ì…˜ì´ë‚˜ ìµœê·¼ ë³¸ ì‘í’ˆì´ ì•„ì§ ì—†ì–´ ì¶”ì²œì„ ê³„ì‚°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>";
            return;
        }

        const scores = artworks
            .filter(a => a.id !== lastViewedId && !collection.includes(a.id))
            .map(a => {
                let score = 0;
                (a.senseTags || []).forEach(tag => {
                    if (tagCount[tag]) score += tagCount[tag];
                });
                return { art: a, score };
            })
            .filter(item => item.score > 0)
            .sort((a, b) => b.score - a.score);

        if (scores.length === 0) {
            els.recommendListEl.innerHTML = "<li>ë¹„ìŠ·í•œ ê°ê° íƒœê·¸ë¥¼ ê°€ì§„ ë‹¤ë¥¸ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</li>";
            return;
        }

        scores.slice(0, 5).forEach(item => {
            const li = document.createElement("li");
            li.textContent = `${item.art.title} (${item.art.artist}) â€“ ì ìˆ˜: ${item.score}`;
            els.recommendListEl.appendChild(li);
        });
    }

    // âœ… Firestoreì— ì €ì¥ëœ ì‚¬ìš©ì ì‘í’ˆë“¤ì„ artworks ë°°ì—´ì— ì¶”ê°€
    function loadUserArtworksFromFirestore() {
      if (!db) return;
      db.collection("artworks").get()
        .then((snapshot) => {
          snapshot.forEach((doc) => {
            const data = doc.data();
            // title / artistê°€ ì—†ëŠ” ë¹ˆ ë¬¸ì„œëŠ” ë¬´ì‹œ
            if (!data.title || !data.artist) return;

            const currentIds = artworks.map(a => a.id || 0);
            const maxId = currentIds.length ? Math.max.apply(null, currentIds) : 0;
            const newId = maxId + 1;

            artworks.push({
              id: newId,
              title: data.title,
              artist: data.artist,
              tradition: data.tradition || "ì„œì–‘",
              region: data.region || (data.tradition === "ë™ì–‘" ? (data.region || "") : "ì„œì–‘"),
              eraMain: data.eraMain || "",
              material: data.material || "",
              year: data.year || "",
              image: data.image || ("https://via.placeholder.com/400x250?text=" + encodeURIComponent(data.title)),
              description: data.description || "ì‚¬ìš©ìê°€ ì§ì ‘ ì¶”ê°€í•œ ì‘í’ˆì…ë‹ˆë‹¤.",
              hashtags: data.hashtags || [],
              senseTags: data.senseTags || []
            });
          });
          console.log("Firestoreì—ì„œ ì‚¬ìš©ì ì‘í’ˆ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ");
        })
        .catch((err) => {
          console.error("Firestoreì—ì„œ ì‘í’ˆ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜: ", err);
        });
    }

    // ===== ì‘í’ˆ ì¶”ê°€ (ë²”ì£¼/ì‹œëŒ€/ì¬ë£Œ í•„ë“œ í¬í•¨ + Firestore ì €ì¥) =====
    function addArtwork() {
        const titleInput = document.getElementById("newTitle");
        const artistInput = document.getElementById("newArtist");
        const tagsInput = document.getElementById("newTags");
        const imageInput = document.getElementById("newImage");
        const traditionInput = document.getElementById("newTradition");
        const eraInput = document.getElementById("newEra");
        const materialInput = document.getElementById("newMaterial");

        const title = titleInput.value.trim();
        const artist = artistInput.value.trim();
        const tagsRaw = tagsInput.value.trim();
        const image = imageInput.value.trim();
        const traditionField = traditionInput.value;         // ì„œì–‘ / ë™ì–‘ / ë¹ˆê°’
        const eraField = eraInput.value.trim();              // ììœ  ì…ë ¥
        const materialField = materialInput.value.trim();    // ììœ  ì…ë ¥

        if (!title || !artist) {
            alert("ì œëª©ê³¼ ì‘ê°€ëŠ” ë°˜ë“œì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
            return;
        }

        // ìµœì¢… tradition ê²°ì •: í¼ > state > ê¸°ë³¸ê°’("ì„œì–‘")
        let tradition = traditionField || state.tradition || "ì„œì–‘";

        // region ê²°ì •: ë™ì–‘ì´ë©´ í˜„ì¬ region ì‚¬ìš©, ì„œì–‘ì´ë©´ "ì„œì–‘"
        let region = "";
        if (tradition === "ë™ì–‘") {
            region = state.region || "";
        } else {
            region = "ì„œì–‘";
        }

        // ì‹œëŒ€/ì¬ë£Œ: í¼ì—ì„œ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ í˜„ì¬ ì„ íƒê°’ ì‚¬ìš©
        const eraMain = eraField || state.eraMain[0] || "";
        const material = materialField || state.material[0] || "";
        const year = "";

        const hashtags = tagsRaw
            ? tagsRaw.split(",").map(t => t.trim()).filter(Boolean)
            : [];
        const senseTags = hashtags.slice();

        const currentIds = artworks.map(a => a.id || 0);
        const maxId = currentIds.length ? Math.max.apply(null, currentIds) : 0;
        const newId = maxId + 1;

        const description = "ì‚¬ìš©ìê°€ ì§ì ‘ ì¶”ê°€í•œ ì‘í’ˆì…ë‹ˆë‹¤.";

        const newArt = {
            id: newId,
            title,
            artist,
            tradition,
            region,
            eraMain,
            material,
            year,
            image: image || ("https://via.placeholder.com/400x250?text=" + encodeURIComponent(title)),
            description,
            hashtags,
            senseTags
        };

        // 1) í™”ë©´ì—ì„œ ë°”ë¡œ ì“°ê¸° ìœ„í•´ ë¡œì»¬ ë°°ì—´ì— ì¶”ê°€
        artworks.push(newArt);

        // 2) Firestoreì—ë„ ì €ì¥ â†’ ë‹¤ë¥¸ ì‚¬ìš©ìë„ ë³¼ ìˆ˜ ìˆê²Œ
        if (db) {
          db.collection("artworks").add({
            title,
            artist,
            tradition,
            region,
            eraMain,
            material,
            year,
            image: newArt.image,
            description,
            hashtags,
            senseTags
          }).then(() => {
            console.log("Firestoreì— ìƒˆ ì‘í’ˆ ì €ì¥ ì™„ë£Œ");
          }).catch((err) => {
            console.error("Firestore ì €ì¥ ì¤‘ ì˜¤ë¥˜: ", err);
          });
        }

        // ì…ë ¥ê°’ ì´ˆê¸°í™”
        titleInput.value = "";
        artistInput.value = "";
        tagsInput.value = "";
        imageInput.value = "";
        traditionInput.value = "";
        eraInput.value = "";
        materialInput.value = "";

        alert("ìƒˆ ì‘í’ˆì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! (Firestoreì—ë„ ì €ì¥ë˜ì—ˆì–´ìš”) ì¡°ê±´ì„ ì„ íƒí•˜ê³  'ì¶”ì²œ ê²°ê³¼ ë³´ê¸°'ë¥¼ ëˆŒëŸ¬ í™•ì¸í•´ ë³´ì„¸ìš”.");
    }

    // === ì´ë²¤íŠ¸ ì—°ê²° ===
    els.traditionSelect.addEventListener("change", () => {
        state.tradition = els.traditionSelect.value;
        state.region = "";
        if (!state.tradition) {
            hide(els.stepRegion);
            hide(els.stepEra);
            hide(els.stepMaterial);
            hide(els.stepArtist);
            hide(els.stepKeyword);
            hide(els.resultContainer);
            return;
        }

        if (state.tradition === "ë™ì–‘") {
            els.regionSelect.value = "";
            show(els.stepRegion);
            hide(els.stepEra);
            hide(els.stepMaterial);
            hide(els.stepArtist);
            hide(els.stepKeyword);
            hide(els.resultContainer);
        } else {
            state.region = "ì„œì–‘";
            hide(els.stepRegion);
            show(els.stepEra);
            populateEraOptions();
        }
    });

    els.regionSelect.addEventListener("change", () => {
        state.region = els.regionSelect.value;
        if (!state.region) {
            hide(els.stepEra);
            hide(els.stepMaterial);
            hide(els.stepArtist);
            hide(els.stepKeyword);
            hide(els.resultContainer);
            return;
        }
        show(els.stepEra);
        populateEraOptions();
    });

    els.eraSelect.addEventListener("change", () => {
        state.eraMain = getSelectedValues(els.eraSelect);
        show(els.stepMaterial);
        populateMaterialOptions();
    });

    els.materialSelect.addEventListener("change", () => {
        state.material = getSelectedValues(els.materialSelect);
        show(els.stepArtist);
        populateArtistOptions();
    });

    els.artistSelect.addEventListener("change", () => {
        state.artist = getSelectedValues(els.artistSelect);
        show(els.stepKeyword);
        hide(els.resultContainer);
    });

    els.recommendBtn.addEventListener("click", () => {
        showResults();
    });

    els.resetBtn.addEventListener("click", () => {
        resetAll();
    });

    els.goBackSelect.addEventListener("change", () => {
        const val = els.goBackSelect.value;
        if (!val) return;
        goBackTo(val);
    });

    // ì´ˆê¸° ë Œë”ë§ + Firestoreì—ì„œ ì‚¬ìš©ì ì‘í’ˆ ë¶ˆëŸ¬ì˜¤ê¸°
    resetAll();
    updateCollectionView();
    updatePlaylistView();
    updateRecommendations();
    loadUserArtworksFromFirestore();
    </script>
</body>
</html>